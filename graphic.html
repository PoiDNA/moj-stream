<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Graphic Vita (One Circle)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: black;
      width: 100%;
      height: 100%;
    }
    /* Kontener wypełnia cały widok, aspect-ratio: 1/1 dla kwadratu */
    #container {
      position: relative;
      width: 100%;
      height: 100%;
      margin: 0;
      aspect-ratio: 1/1;
      background-color: black;
    }
    #vitaCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>
</head>
<body>
  <div id="container">
    <canvas id="vitaCanvas"></canvas>
  </div>
  <script>
    let circlesData = null;

    // Odbiór danych z postMessage (Wix)
    window.addEventListener("message", function(event) {
      if (event.data.action === "download") {
        downloadCanvas();
      }
      else if (event.data.circles) {
        circlesData = event.data.circles;
        drawGraphic();
      }
    }, false);

    function drawGraphic() {
      const canvas = document.getElementById("vitaCanvas");
      const ctx = canvas.getContext("2d");
      
      // Ustalamy rozmiary canvas
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height;

      // Tło czarne
      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Sprawdzamy, czy mamy dane
      if (!circlesData || circlesData.length === 0) {
        console.warn("[graphic.html] Brak danych do rysowania!");
        return;
      }

      // Pobieramy jedyny obiekt (jedno koło)
      const data = circlesData[0];
      
      // Kolory i ustawienia pędzla
      ctx.strokeStyle = "white";
      ctx.fillStyle = "white";
      ctx.textAlign = "center";

      // Ustalamy pozycję koła w środku canvas
      const cx = canvas.width / 2;
      const cy = canvas.height / 2;

      // Koło 40% większe względem dotychczasowego ( canvas.width / 12 )
      const circleRadius = (canvas.width / 12) * 1.4;

      // Rysujemy koło
      ctx.beginPath();
      ctx.arc(cx, cy, circleRadius, 0, 2 * Math.PI);
      ctx.stroke();

      // Teraz wyświetlamy teksty
      // Odległość 100px od dołu koła do pierwszej linii
      let yText = cy + circleRadius + 100;

      // Zbieramy w tablicę tylko niepuste pola
      let descriptions = [];
      if (data.textH && data.textH.trim() !== "") {
        descriptions.push(data.textH);
      }
      if (data.textD && data.textD.trim() !== "") {
        descriptions.push(data.textD);
      }
      if (data.textC && data.textC.trim() !== "") {
        descriptions.push(data.textC);
      }

      // Ustawiamy większą czcionkę do opisów
      ctx.font = "bold 18px Arial";

      // Każdy opis w kolejnej linii, z odstępem 35px
      const lineSpacing = 35;
      descriptions.forEach((desc) => {
        ctx.fillText(desc, cx, yText);
        yText += lineSpacing;
      });

      // Po (ewentualnych) opisach rysujemy linijkę z liczbami pierwszymi
      // Dodajemy 100px od poprzedniej linii
      yText += 100;
      ctx.font = "16px Arial";
      // Format: ujemna.dodatnia (bez spacji)
      let primesText = data.primeNegative + "." + data.primePositive;
      ctx.fillText(primesText, cx, yText);
    }

    function downloadCanvas() {
      const canvas = document.getElementById("vitaCanvas");
      const link = document.createElement("a");
      link.download = "graphic.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }

    // Fallback – jeśli 2 sek. brak danych, pokaż przykładowe
    setTimeout(() => {
      if (!circlesData || circlesData.length === 0) {
        console.warn("[graphic.html] Brak danych - fallback");
        circlesData = [{
          textH: "",
          textD: "",
          textC: "",
          primePositive: 2,
          primeNegative: -3
        }];
        drawGraphic();
      }
    }, 2000);

    // Przerysowujemy obraz przy zmianie rozmiaru
    window.addEventListener("resize", () => {
      if (circlesData) {
        drawGraphic();
      }
    });
  </script>
</body>
</html>
