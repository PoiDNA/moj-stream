<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Kontroler Tone.js</title>
  <!-- Tone.js z CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <!-- dat.GUI z CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { margin-bottom: 0; }
    p { margin-top: 5px; }
    button { margin-right: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Kontroler Tone.js</h1>
  <p>Użyj poniższych przycisków i suwaków, aby sterować generowaniem dźwięków.</p>
  <button id="startButton">Uruchom Audio</button>
  <button id="triggerNote">Zagraj dźwięk</button>
  <button id="toggleNoise">Włącz/Wyłącz Szum</button>
  
  <script>
    // Aktywacja kontekstu audio na żądanie użytkownika
    document.getElementById("startButton").addEventListener("click", async function(){
      await Tone.start();
      console.log("Audio Context uruchomiony");
    });

    // --- Syntezator i łańcuch efektów ---
    const synth = new Tone.Synth({
      oscillator: {
        type: "sine",
        detune: 0,
        phase: 0,
        partials: []
      },
      envelope: {
        attack: 0.1,
        decay: 0.2,
        sustain: 0.5,
        release: 1,
        attackCurve: "linear",
        decayCurve: "linear",
        releaseCurve: "linear"
      }
    });

    const filter = new Tone.Filter({
      type: "lowpass",
      frequency: 1000,
      Q: 1,
      rolloff: -12
    });

    // Efekty:
    const delay = new Tone.FeedbackDelay({
      delayTime: 0.25,
      feedback: 0.3,
      wet: 0.5
    });
    const reverb = new Tone.Reverb({
      decay: 2,
      preDelay: 0.01,
      wet: 0.5
    });
    const chorus = new Tone.Chorus({
      frequency: 1.5,
      delayTime: 3.5,
      depth: 0.7,
      feedback: 0.2,
      wet: 0.5
    }).start();
    const distortion = new Tone.Distortion({
      distortion: 0.4,
      oversample: "4x",
      wet: 0.5
    });

    const volume = new Tone.Volume(-12);
    const panner = new Tone.Panner(0);

    // LFO do modulacji (np. częstotliwości filtra)
    const lfo = new Tone.LFO({
      frequency: 0.5,
      min: 400,
      max: 1600,
      phase: 0,
      type: "sine"
    }).start();
    lfo.connect(filter.frequency);

    // Łańcuch: syntezator -> filtr -> delay -> reverb -> chorus -> distortion -> volume -> panner -> wyjście
    synth.chain(filter, delay, reverb, chorus, distortion, volume, panner, Tone.Destination);

    // --- Szumy i dźwięki binauralne ---
    // Tworzymy generator szumu, który domyślnie generuje biały szum
    const noise = new Tone.Noise("white").start();
    // Oddzielny kontroler głośności dla szumu
    const noiseVolume = new Tone.Volume(-12);
    // Panner 3D do symulacji efektu binauralnego
    const binauralPanner = new Tone.Panner3D({
      positionX: 0,
      positionY: 0,
      positionZ: -1
    }).toDestination();
    // Łańcuch: szum -> noiseVolume -> binauralPanner
    noise.chain(noiseVolume, binauralPanner);

    // Przycisk do włączania/wyłączania szumu
    let noiseActive = true;
    document.getElementById("toggleNoise").addEventListener("click", function(){
      if (noiseActive) {
        noise.stop();
        noiseActive = false;
        console.log("Szum wyłączony");
      } else {
        noise.start();
        noiseActive = true;
        console.log("Szum włączony");
      }
    });

    // --- Panel kontrolny dat.GUI ---
    const gui = new dat.GUI();

    // 1. Oscylatory
    const oscFolder = gui.addFolder("Oscylator");
    const oscSettings = {
      type: "sine",
      detune: 0,
      phase: 0,
      partials: 0
    };
    oscFolder.add(oscSettings, "type", ["sine", "square", "triangle", "sawtooth"]).onChange(val => {
      synth.oscillator.type = val;
    });
    oscFolder.add(oscSettings, "detune", -1200, 1200).onChange(val => {
      synth.oscillator.detune = val;
    });
    oscFolder.add(oscSettings, "phase", 0, 360).onChange(val => {
      synth.oscillator.phase = val;
    });
    oscFolder.add(oscSettings, "partials", 0, 10, 1).onChange(val => {
      if(val == 0) {
        synth.oscillator.partials = [];
      } else {
        const arr = [];
        for(let i = 1; i <= val; i++){
          arr.push(i);
        }
        synth.oscillator.partials = arr;
      }
    });
    oscFolder.open();

    // 2. Obwiednie (Envelope)
    const envFolder = gui.addFolder("Obwiednia (Envelope)");
    const envSettings = {
      attack: 0.1,
      decay: 0.2,
      sustain: 0.5,
      release: 1,
      attackCurve: "linear",
      decayCurve: "linear",
      releaseCurve: "linear"
    };
    envFolder.add(envSettings, "attack", 0, 2).onChange(val => {
      synth.envelope.attack = val;
    });
    envFolder.add(envSettings, "decay", 0, 2).onChange(val => {
      synth.envelope.decay = val;
    });
    envFolder.add(envSettings, "sustain", 0, 1).onChange(val => {
      synth.envelope.sustain = val;
    });
    envFolder.add(envSettings, "release", 0, 5).onChange(val => {
      synth.envelope.release = val;
    });
    envFolder.add(envSettings, "attackCurve", ["linear", "exponential"]).onChange(val => {
      synth.envelope.attackCurve = val;
    });
    envFolder.add(envSettings, "decayCurve", ["linear", "exponential"]).onChange(val => {
      synth.envelope.decayCurve = val;
    });
    envFolder.add(envSettings, "releaseCurve", ["linear", "exponential"]).onChange(val => {
      synth.envelope.releaseCurve = val;
    });
    envFolder.open();

    // 3. Filtry
    const filterFolder = gui.addFolder("Filtr");
    const filterSettings = {
      type: "lowpass",
      frequency: 1000,
      Q: 1,
      gain: 0,
      rolloff: -12
    };
    filterFolder.add(filterSettings, "type", ["lowpass", "highpass", "bandpass", "notch"]).onChange(val => {
      filter.type = val;
    });
    filterFolder.add(filterSettings, "frequency", 20, 20000).onChange(val => {
      filter.frequency.value = val;
    });
    filterFolder.add(filterSettings, "Q", 0.1, 20).onChange(val => {
      filter.Q.value = val;
    });
    filterFolder.add(filterSettings, "gain", -40, 40).onChange(val => {
      filter.gain = val;
    });
    filterFolder.add(filterSettings, "rolloff", [-12, -24]).onChange(val => {
      filter.rolloff = val;
    });
    filterFolder.open();

    // 4. Efekty
    const effectsFolder = gui.addFolder("Efekty");
    const delayFolder = effectsFolder.addFolder("Delay");
    const delaySettings = {
      delayTime: 0.25,
      feedback: 0.3,
      wet: 0.5
    };
    delayFolder.add(delaySettings, "delayTime", 0, 1).onChange(val => {
      delay.delayTime.value = val;
    });
    delayFolder.add(delaySettings, "feedback", 0, 1).onChange(val => {
      delay.feedback.value = val;
    });
    delayFolder.add(delaySettings, "wet", 0, 1).onChange(val => {
      delay.wet.value = val;
    });
    delayFolder.open();

    const reverbFolder = effectsFolder.addFolder("Reverb");
    const reverbSettings = {
      decay: 2,
      preDelay: 0.01,
      wet: 0.5
    };
    reverbFolder.add(reverbSettings, "decay", 0, 10).onChange(val => {
      reverb.decay = val;
      reverb.generate();
    });
    reverbFolder.add(reverbSettings, "preDelay", 0, 1).onChange(val => {
      reverb.preDelay = val;
    });
    reverbFolder.add(reverbSettings, "wet", 0, 1).onChange(val => {
      reverb.wet.value = val;
    });
    reverbFolder.open();

    const chorusFolder = effectsFolder.addFolder("Chorus/Flanger/Phaser");
    const chorusSettings = {
      frequency: 1.5,
      delayTime: 3.5,
      depth: 0.7,
      feedback: 0.2,
      wet: 0.5
    };
    chorusFolder.add(chorusSettings, "frequency", 0.1, 10).onChange(val => {
      chorus.frequency.value = val;
    });
    chorusFolder.add(chorusSettings, "delayTime", 0, 10).onChange(val => {
      chorus.delayTime = val;
    });
    chorusFolder.add(chorusSettings, "depth", 0, 1).onChange(val => {
      chorus.depth = val;
    });
    chorusFolder.add(chorusSettings, "feedback", 0, 1).onChange(val => {
      chorus.feedback = val;
    });
    chorusFolder.add(chorusSettings, "wet", 0, 1).onChange(val => {
      chorus.wet.value = val;
    });
    chorusFolder.open();

    const distortionFolder = effectsFolder.addFolder("Distortion");
    const distortionSettings = {
      distortion: 0.4,
      oversample: "4x",
      wet: 0.5
    };
    distortionFolder.add(distortionSettings, "distortion", 0, 1).onChange(val => {
      distortion.distortion = val;
    });
    distortionFolder.add(distortionSettings, "oversample", ["none", "2x", "4x"]).onChange(val => {
      distortion.oversample = val;
    });
    distortionFolder.add(distortionSettings, "wet", 0, 1).onChange(val => {
      distortion.wet.value = val;
    });
    distortionFolder.open();

    // 5. Kontrola Głośności i Panoramowanie
    const outputFolder = gui.addFolder("Głośność i Panoramowanie");
    const outputSettings = {
      volume: -12,
      pan: 0
    };
    outputFolder.add(outputSettings, "volume", -60, 0).onChange(val => {
      volume.volume.value = val;
    });
    outputFolder.add(outputSettings, "pan", -1, 1).onChange(val => {
      panner.pan.value = val;
    });
    outputFolder.open();

    // 6. Modulatory i LFO (Low-Frequency Oscillator)
    const lfoFolder = gui.addFolder("LFO (Modulatory)");
    const lfoSettings = {
      frequency: 0.5,
      min: 400,
      max: 1600,
      phase: 0,
      type: "sine"
    };
    lfoFolder.add(lfoSettings, "frequency", 0.1, 10).onChange(val => {
      lfo.frequency.value = val;
    });
    lfoFolder.add(lfoSettings, "min", 20, 1000).onChange(val => {
      lfo.min = val;
    });
    lfoFolder.add(lfoSettings, "max", 100, 5000).onChange(val => {
      lfo.max = val;
    });
    lfoFolder.add(lfoSettings, "phase", 0, 360).onChange(val => {
      lfo.phase = val;
    });
    lfoFolder.add(lfoSettings, "type", ["sine", "square", "triangle", "sawtooth"]).onChange(val => {
      lfo.type = val;
    });
    lfoFolder.open();

    // 7. Parametry Automatyzacji i Sterowania
    const automationFolder = gui.addFolder("Automatyzacja");
    const automationSettings = {
      rampAttack: function(){
        // Przykład: liniowy wzrost częstotliwości oscylatora od obecnej wartości do 800 Hz w ciągu 2 sekund.
        synth.oscillator.frequency.linearRampTo(800, 2);
      }
    };
    automationFolder.add(automationSettings, "rampAttack");
    automationFolder.open();

    // 8. Globalne Parametry Czasowe
    const timeFolder = gui.addFolder("Globalne Parametry Czasowe");
    const timeSettings = {
      tempo: 120,
      swing: 0,
      timeSignature: "4/4"
    };
    timeFolder.add(timeSettings, "tempo", 40, 300).onChange(val => {
      Tone.Transport.bpm.value = val;
    });
    timeFolder.add(timeSettings, "swing", 0, 1).onChange(val => {
      Tone.Transport.swing = val;
    });
    timeFolder.add(timeSettings, "timeSignature", ["2/4", "3/4", "4/4", "6/8"]).onChange(val => {
      Tone.Transport.timeSignature = val;
    });
    timeFolder.open();

    // --- Nowe GUI dla szumów i dźwięków binauralnych ---
    const noiseFolder = gui.addFolder("Szumy");
    const noiseSettings = {
      type: "white",
      volume: -12
    };
    noiseFolder.add(noiseSettings, "type", ["white", "pink", "brown"]).onChange(val => {
      noise.type = val;
    });
    noiseFolder.add(noiseSettings, "volume", -60, 0).onChange(val => {
      noiseVolume.volume.value = val;
    });
    noiseFolder.open();

    const binauralFolder = gui.addFolder("Dźwięki Binauralne");
    const binauralSettings = {
      positionX: 0,
      positionY: 0,
      positionZ: -1
    };
    binauralFolder.add(binauralSettings, "positionX", -10, 10).onChange(val => {
      binauralPanner.positionX = val;
    });
    binauralFolder.add(binauralSettings, "positionY", -10, 10).onChange(val => {
      binauralPanner.positionY = val;
    });
    binauralFolder.add(binauralSettings, "positionZ", -10, 10).onChange(val => {
      binauralPanner.positionZ = val;
    });
    binauralFolder.open();

    // Przycisk do wyzwolenia dźwięku – trigger pojedynczej nuty "C4"
    document.getElementById("triggerNote").addEventListener("click", function(){
      synth.triggerAttackRelease("C4", "8n", Tone.now(), 0.7);
    });
  </script>
</body>
</html>
