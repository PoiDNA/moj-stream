<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Graphic Vita</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      background-color: black;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      background-color: black;
    }
  </style>
</head>
<body>
  <canvas id="vitaCanvas" width="900" height="900"></canvas>
  <script>
    let circlesData = null;
    
    // Nasłuchujemy komunikatów przesyłanych przez postMessage
    window.addEventListener("message", function(event) {
      if (event.data.action === "download") {
         downloadCanvas();
      } else if (event.data.circles) {
         circlesData = event.data.circles;
         drawGraphic();
      }
    }, false);
    
    // Funkcja rysująca grafikę: 9 okręgów w układzie 3x3
    function drawGraphic() {
      const canvas = document.getElementById("vitaCanvas");
      const ctx = canvas.getContext("2d");
      // Czyścimy canvas i ustawiamy czarne tło
      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Ustawiamy biały kolor dla rysowania
      ctx.fillStyle = "white";
      ctx.strokeStyle = "white";
      ctx.textAlign = "center";
      ctx.font = "16px Arial";
      
      // Obliczamy pozycje okręgów w układzie 3x3
      const gridRows = 3, gridCols = 3;
      const circleRadius = 50;
      const offsetX = canvas.width / (gridCols + 1);
      const offsetY = canvas.height / (gridRows + 1);
      
      for (let i = 0; i < circlesData.length; i++) {
         let row = Math.floor(i / gridCols);
         let col = i % gridCols;
         let x = offsetX * (col + 1);
         let y = offsetY * (row + 1);
         
         // Rysujemy okrąg
         ctx.beginPath();
         ctx.arc(x, y, circleRadius, 0, 2 * Math.PI);
         ctx.stroke();
         
         // Nad okręgiem – wyświetlamy przetworzony tekst (litery i spacje oddzielone pojedynczą spacją)
         ctx.fillText(circlesData[i].text, x, y - circleRadius - 20);
         
         // Pod okręgiem – wyświetlamy losowo dobrane liczby pierwsze (dodatnią i ujemną)
         let primesText = circlesData[i].primePositive + " " + circlesData[i].primeNegative;
         ctx.fillText(primesText, x, y + circleRadius + 20);
      }
    }
    
    // Funkcja pobierająca zawartość canvas jako obraz PNG
    function downloadCanvas() {
      const canvas = document.getElementById("vitaCanvas");
      const link = document.createElement("a");
      link.download = "graphic.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }
  </script>
</body>
</html>
